@page "/users"
@attribute [AllowAnonymous]

<PageTitle>
    @localizer[nameof(AppStrings.Users)]
</PageTitle>

<FritzBreadcrumbs Items="_items"/>

<MudTable ServerData="ServerReload"
          Dense="true"
          Hover="true"
          Elevation="3"
          @ref="_table"
          Context="user">
    <ToolBarContent>
        <MudText Typo="Typo.h6">
            @localizer[nameof(AppStrings.Users)]
        </MudText>
        <MudSpacer/>
        <FritzSearchTextField @bind-Value="_searchString"
                              OnSearch="() => _table.ReloadServerData()"
                              UserAttributes="@(new Dictionary<string, object> { { TestConst.TestId, UsersPageConst.SearchInput } })"/>
    </ToolBarContent>
    <HeaderContent>
        <MudTh>
            <MudTableSortLabel SortLabel="username"
                               T="UserDto"
                               UserAttributes="@(new Dictionary<string, object> { { TestConst.TestId, UsersPageConst.UserNameTableSortLabel } })">
                @localizer[nameof(AppStrings.UserName)]
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="email"
                               T="UserDto"
                               UserAttributes="@(new Dictionary<string, object> { { TestConst.TestId, UsersPageConst.EmailTableSortLabel } })">
                @localizer[nameof(AppStrings.Email)]
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            @localizer[nameof(AppStrings.Role)]
        </MudTh>
        <MudTh>
            @localizer[nameof(AppStrings.Playlists)]
        </MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="@localizer[nameof(AppStrings.UserName)]"
               UserAttributes="@(new Dictionary<string, object> { { TestConst.TestId, UsersPageConst.UserNameTableRowData } })">
            @user.UserName
        </MudTd>
        <MudTd DataLabel="@localizer[nameof(AppStrings.Email)]">
            @user.Email
        </MudTd>
        <MudTd DataLabel="@localizer[nameof(AppStrings.Role)]">
            <MudChip T="Color"
                     Variant="Variant.Outlined"
                     Color="GetColorBasedOnPolicy(GetUserHighestPolicy(user))">
                @GetUserHighestPolicy(user)
            </MudChip>
        </MudTd>
        <MudTd DataLabel="@localizer[nameof(AppStrings.Playlists)]">
            <FritzTooltip Text="@localizer[nameof(AppStrings.Playlists)]">
                <MudIconButton Icon="@Icons.Material.Filled.List"
                               Color="Color.Primary"
                               Size="Size.Small"
                               OnClick="() => RedirectToUserPlaylistsPage(user.Id)"
                               UserAttributes="@(new Dictionary<string, object> { { TestConst.TestId, UsersPageConst.NavigateToUserPlaylistsButton } })"/>
            </FritzTooltip>
        </MudTd>
    </RowTemplate>
    <NoRecordsContent>
        <MudText>
            @localizer[nameof(AppStrings.NoMatchingRecordsFound)]
        </MudText>
    </NoRecordsContent>
    <LoadingContent>
        <MudText>
            @localizer[nameof(AppStrings.Loading)]
        </MudText>
    </LoadingContent>
    <PagerContent>
        <MudTablePager RowsPerPageString="@localizer[nameof(AppStrings.RowsPerPage)]"
                       InfoFormat="@localizer[nameof(AppStrings.PaginationInfoFormat)]"/>
    </PagerContent>
</MudTable>