@page "/downloadPlaylist/{PlaylistId:int}"
@attribute [AllowAnonymous]

<PageTitle>
    @Localizer[nameof(AppStrings.DownloadPlaylist)]
</PageTitle>

@if (_playlist != null && _linkInfoList != null)
{
    <FritzBreadcrumbs Items=_items />

    <MudText Typo=Typo.subtitle1>
        @Localizer[nameof(AppStrings.LoadedLinks), _linkInfoList.Count]
    </MudText>
    <MudText Typo=Typo.subtitle2
             Color="Color.Warning">
        @Localizer[nameof(AppStrings.PublicPlaylistDownloadInfo)]
    </MudText>
    <MudText Typo=Typo.subtitle2
             Color="Color.Warning">
        @Localizer[nameof(AppStrings.PrivatePlaylistDownloadInfo)]
    </MudText>

    <FritzProcessingButton @ref=_processingButton
                           Color=Color.Primary
                           ProcessingButtonText=@Localizer[nameof(AppStrings.Downloading)]
                           ButtonText=@Localizer[nameof(AppStrings.Download)]
                           OnClick=DownloadPlaylistLinks />

    @if (_downloading)
    {
        <MudProgressLinear Color=Color.Primary
                           Striped=true
                           Size=Size.Large
                           Value=_downloadPercent
                           Class="my-7"
                           Style="height: 30px;">
            <MudText Typo=Typo.h6
                     Style="@($"color:{Colors.Grey.Darken4};")">
                @((int)_downloadPercent)% - @_downloadingSongTitle
            </MudText>
        </MudProgressLinear>
    }

    @if (_downloadLinkResults is not null)
    {
        <MudItem xs=12>
            <MudPaper Class="pa-4 mt-4">
                <MudText Typo=Typo.subtitle2>
                    @Localizer[nameof(AppStrings.DownloadedLinksCountResults), _downloadLinkResults.Count]
                </MudText>
                @foreach (var result in _downloadLinkResults)
                {
                    @if (result.Success)
                    {
                        <a href="@result.Link.Url" target="_blank">
                            <MudText Color=@Color.Success>
                                [@Localizer[nameof(AppStrings.Success)]] - @result.Link.Title
                            </MudText>
                        </a>
                    }
                    else
                    {
                        <a href="@result.Link.Url" target="_blank">
                            <MudText Color=@Color.Error>
                                [@Localizer[nameof(AppStrings.Fail)]] - @result.Link.Title
                            </MudText>
                        </a>
                    }
                }
            </MudPaper>
        </MudItem>
    }
}
